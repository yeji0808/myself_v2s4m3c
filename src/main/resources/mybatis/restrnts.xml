<?xml version="1.0" encoding="UTF-8"?>
 
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="dev.mvc.restrnts.RestrntsDAOInter"> 
   <insert id="create" parameterType="RestrntsVO">
     INSERT INTO restrnts(restno, rcateno, memberno, rname, rmain, rintro, rtime, rcall, 
                                  rzipcode, raddress1, raddress2, rword,
                                  fname, fupname, thumb, fsize)
     VALUES((SELECT NVL(MAX(restno), 0) + 1 as restno FROM restrnts),
                  #{rcateno}, #{memberno}, #{rname}, #{rmain}, #{rintro}, #{rtime}, #{rcall}, 
                  #{rzipcode}, #{raddress1}, #{raddress2}, #{rword},
                  #{fname}, #{fupname}, #{thumb}, #{fsize})
   </insert>
   
   <select id="list_map" resultType="RestrntsVO">
     SELECT restno, rcateno, memberno, rname, rmain, rintro, rtime, rcall,
                rzipcode, raddress1, raddress2, rword, rrecom, rcnt, reviewcnt,
                fname, fupname, thumb, fsize
     FROM restrnts
     ORDER BY restno ASC
   </select> 
   
   <select id="list_by_rcateno" resultType="RestrntsVO" parameterType="int">
     SELECT restno, rcateno, memberno, rname, rmain, rintro, rtime, rcall,
                rzipcode, raddress1, raddress2, rword, rrecom, rcnt, reviewcnt,
                fname, fupname, thumb, fsize
     FROM restrnts
     WHERE rcateno=#{rcateno}
     ORDER BY rname ASC
   </select> 
   
   <delete id="delete" parameterType="int">
      DELETE FROM restrnts
      WHERE restno=#{restno}
   </delete> 
   
   <select id="read" resultType="RestrntsVO" parameterType="int">
      SELECT restno, rcateno, memberno, rname, rmain, rintro, rtime, rcall, 
             rzipcode, raddress1, raddress2, rword, rrecom, rcnt, reviewcnt,
             fname, fupname, thumb, fsize
      FROM restrnts
      WHERE restno=#{restno}
   </select>
   
  <update id='update' parameterType="RestrntsVO">
     UPDATE restrnts
     SET   rmain=#{rmain}, rintro=#{rintro}, rtime=#{rtime}, rcall=#{rcall}, 
             rword=#{rword}
     WHERE restno = #{restno}
   </update>
   
   <update id='update_img' parameterType="RestrntsVO">
     UPDATE restrnts
     SET   fname=#{fname}, fupname=#{fupname}, thumb=#{thumb}, fsize=#{fsize}
     WHERE restno = #{restno}
   </update>
   
   <select id="lastnum" resultType="int">
    SELECT restno 
    FROM(
            SELECT restno
            FROM restrnts
            ORDER BY restno DESC)
    WHERE ROWNUM = 1
    </select>
    
   <update id="increaseCnt" parameterType="int">
     UPDATE restrnts
     SET rcnt = rcnt + 1 
     WHERE restno = #{restno}
   </update>

          
</mapper>





